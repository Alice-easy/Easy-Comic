# Easy Comic - æ‚¨çš„ä¸“å±æ¼«ç”»é˜…è¯»å™¨

[![MIT License](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![GitHub stars](https://img.shields.io/github/stars/alice-easy/Easy-Comic.svg)](https://github.com/alice-easy/Easy-Comic/stargazers)
[![GitHub forks](https://img.shields.io/github/forks/alice-easy/Easy-Comic.svg)](https://github.com/alice-easy/Easy-Comic/network/members)
[![GitHub issues](https://img.shields.io/github/issues/alice-easy/Easy-Comic.svg)](https://github.com/alice-easy/Easy-Comic/issues)

![Easy Comic Icon](assets/icon/icon.png)

**Easy Comic** æ˜¯ä¸€æ¬¾ä¸ºæ¼«ç”»çˆ±å¥½è€…æ‰“é€ çš„ã€æ³¨é‡éšç§å’Œæ•°æ®ä¸»æƒçš„å¼€æºæ¼«ç”»é˜…è¯»å™¨ã€‚å®ƒåŸºäº Flutter æ„å»ºï¼Œè®©æ‚¨å¯ä»¥è½»æ¾åœ°åœ¨è®¾å¤‡ä¸Šé˜…è¯»æœ¬åœ°æ¼«ç”»ï¼Œå¹¶é€šè¿‡ WebDAV å°†æ‚¨çš„é˜…è¯»è¿›åº¦å®‰å…¨åœ°åŒæ­¥åˆ°æ‚¨è‡ªå·±çš„æœåŠ¡å™¨ã€‚

## âœ¨ åŠŸèƒ½äº®ç‚¹

- **å¼ºå¤§çš„æ ¼å¼æ”¯æŒ**:
  - ç›´æ¥è¯»å–å¸¸è§çš„æ¼«ç”»å‹ç¼©åŒ…æ ¼å¼ï¼Œæ— éœ€æ‰‹åŠ¨è§£å‹ã€‚
  - åœ¨å‹ç¼©åŒ…å†…è‡ªåŠ¨è¯†åˆ«å¹¶æ’åºå›¾ç‰‡æ–‡ä»¶ã€‚

- **æ²‰æµ¸å¼é˜…è¯»ä½“éªŒ**:
  - æä¾›åŸºäº `photo_view` çš„æµç•…ã€å¯ç¼©æ”¾çš„é˜…è¯»ç•Œé¢ã€‚
  - æ”¯æŒæ‰‹åŠ¿ç¼©æ”¾ã€å¹³ç§»ï¼Œä¸“æ³¨äºå†…å®¹æœ¬èº«ã€‚
  - è®°å½•æ¯æœ¬æ¼«ç”»çš„é˜…è¯»è¿›åº¦ã€‚

- **æ™ºèƒ½åŒæ­¥å¼•æ“**:
  - é€šè¿‡ WebDAV åŒæ­¥**é˜…è¯»è¿›åº¦**è€Œéæ•´ä¸ªæ¼«ç”»æ–‡ä»¶ï¼Œæå¤§åœ°èŠ‚çœäº†ç½‘ç»œæµé‡å’ŒåŒæ­¥æ—¶é—´ã€‚
  - é‡‡ç”¨æ™ºèƒ½æ¯”è¾ƒæœºåˆ¶ï¼ˆETag å’Œæ—¶é—´æˆ³ï¼‰ï¼Œç¡®ä¿æ•°æ®é«˜æ•ˆã€å‡†ç¡®åœ°åŒæ­¥ã€‚
  - æ”¯æŒå¹¶å‘åŒæ­¥ï¼Œæå‡å¤§è§„æ¨¡æ•°æ®å¤„ç†èƒ½åŠ›ã€‚

- **æ•°æ®å½’ä½ æ‰€æœ‰**:
  - æ‚¨çš„æ‰€æœ‰é˜…è¯»æ•°æ®ï¼ˆè¿›åº¦ã€è®¾ç½®ç­‰ï¼‰éƒ½å­˜å‚¨åœ¨æ‚¨è‡ªå·±æ§åˆ¶çš„ WebDAV æœåŠ¡å™¨ä¸Šï¼Œæˆ‘ä»¬ä¸æ”¶é›†ä»»ä½•ç”¨æˆ·ä¿¡æ¯ã€‚

- **è·¨å¹³å°è®¾è®¡**:
  - åŸºäº Flutter æ„å»ºï¼Œå¤©ç„¶å…·å¤‡è·¨å¹³å°èƒ½åŠ›ï¼Œæœªæ¥å¯è½»æ¾æ‰©å±•è‡³æ¡Œé¢ç«¯å’Œ Web ç«¯ã€‚

## ğŸ“ æ”¯æŒçš„æ ¼å¼

- **æ¼«ç”»åŒ…æ ¼å¼**: `.cbz`, `.zip`
- **å›¾ç‰‡æ–‡ä»¶æ ¼å¼**: `.jpg`, `.jpeg`, `.png`, `.gif`, `.webp`

> **æ³¨æ„**: ç›®å‰æš‚ä¸æ”¯æŒ `.cbr` (RAR å‹ç¼©) æ ¼å¼ã€‚

## ğŸ”„ åŒæ­¥é€»è¾‘ (How Sync Works)

ä¸ºäº†è®©æ‚¨æ›´å¥½åœ°ç†è§£æ•°æ®æ˜¯å¦‚ä½•åœ¨æœ¬åœ°è®¾å¤‡å’Œæ‚¨çš„ WebDAV æœåŠ¡å™¨ä¹‹é—´æµåŠ¨çš„ï¼Œæˆ‘ä»¬ç»˜åˆ¶äº†ä»¥ä¸‹çš„åŒæ­¥æµç¨‹å›¾ã€‚å®ƒå±•ç¤ºäº† `SyncEngine` å¦‚ä½•æ™ºèƒ½åœ°æ¯”è¾ƒæ•°æ®å¹¶å†³å®šé‡‡å–ä½•ç§æ“ä½œã€‚

```mermaid
graph TD
    subgraph "æœ¬åœ°è®¾å¤‡ (Local Device)"
        A[æœ¬åœ° SQLite æ•°æ®åº“]
        A_DATA["
            <b>ComicProgress Table</b><br/>
            - fileHash (PK)<br/>
            - currentPage<br/>
            - totalPages<br/>
            - updatedAt<br/>
            - etag
        "]
        A --> A_DATA
    end

    subgraph "WebDAV æœåŠ¡å™¨ (WebDAV Server)"
        B[è¿œç¨‹ /comic_progress/ ç›®å½•]
        B_DATA["
            <b>JSON æ–‡ä»¶</b><br/>
            - fileHash.json<br/>
            - åŒ…å« currentPage, totalPages, updatedAt<br/>
            - æ–‡ä»¶æœ¬èº«æœ‰ ETag
        "]
        B --> B_DATA
    end

    subgraph "åŒæ­¥å¼•æ“ (Sync Engine)"
        C{å¼€å§‹åŒæ­¥}
        C --> C1[1. è·å–æœ¬åœ°æ•°æ® Map<fileHash, SyncDataItem>];
        C --> C2[2. è·å–è¿œç¨‹æ•°æ® Map<fileHash, SyncDataItem>];
        
        subgraph "3. æ¯”è¾ƒä¸å†³ç­– (Compare & Decide)"
            D{éå†æ‰€æœ‰ fileHash};
            D --> D1{ä»…æœ¬åœ°å­˜åœ¨?};
            D1 -- æ˜¯ --> OP_UP[æ ‡è®°ä¸ºä¸Šä¼ ];
            
            D1 -- å¦ --> D2{ä»…è¿œç¨‹å­˜åœ¨?};
            D2 -- æ˜¯ --> OP_DOWN[æ ‡è®°ä¸ºä¸‹è½½];

            D2 -- å¦ --> D3{ä¸¤ä¾§éƒ½å­˜åœ¨};
            D3 --> D4{ETag æ˜¯å¦åŒ¹é…?};
            D4 -- æ˜¯ --> OP_SKIP[è·³è¿‡/æ— éœ€åŒæ­¥];
            D4 -- å¦ --> D5{æ¯”è¾ƒ updatedAt};
            D5 -- æœ¬åœ°æ›´æ–°? --> OP_UP;
            D5 -- è¿œç¨‹æ›´æ–°? --> OP_DOWN;
            D5 -- æ—¶é—´ç›¸åŒ? --> OP_CONFLICT[æ ‡è®°ä¸ºå†²çª];
        end

        subgraph "4. æ‰§è¡Œæ“ä½œ (Execute Operations)"
            E{å¹¶å‘æ‰§è¡Œé˜Ÿåˆ—};
            OP_UP --> E;
            OP_DOWN --> E;
            OP_CONFLICT --> E;
            
            E --> E_UP[ä¸Šä¼  .json å¹¶æ›´æ–°æœ¬åœ° ETag];
            E --> E_DOWN[æ›´æ–°æœ¬åœ°æ•°æ®åº“è®°å½•];
            E --> E_CONFLICT["æ ¹æ®ç­–ç•¥è§£å†³å†²çª<br/>(é»˜è®¤: æœ¬åœ°ä¼˜å…ˆ -> ä¸Šä¼ )"];
        end
    end

    A <--> C1;
    B <--> C2;
    E_UP --> B;
    E_DOWN --> A;
    E_CONFLICT --> A;
    E_CONFLICT --> B;
```

## ğŸš€ å¼€å§‹ä½¿ç”¨

### ç¯å¢ƒè¦æ±‚

- Flutter SDK: `^3.8.1`
- Dart SDK: `^3.8.1`

### å®‰è£…ä¸è¿è¡Œ

1.  **å…‹éš†ä»“åº“**
    ```sh
    git clone https://github.com/alice-easy/Easy-Comic.git
    cd Easy-Comic
    ```

2.  **å®‰è£…ä¾èµ–**
    ```sh
    flutter pub get
    ```

3.  **è¿è¡Œåº”ç”¨**
    ```sh
    flutter run
    ```

## ğŸ› ï¸ å¼€å‘

é¡¹ç›®åœ¨ `scripts` ç›®å½•ä¸‹æä¾›äº†ä¸€äº›ä¾¿æ·çš„å¼€å‘è„šæœ¬ï¼Œä»¥ç®€åŒ–å¼€å‘æµç¨‹ã€‚

- **`scripts/dev.bat`**: (Windows) å¯åŠ¨å¼€å‘æ¨¡å¼ã€‚
- **`scripts/format.bat`**: (Windows) æ ¼å¼åŒ–ä»£ç å¹¶è¿›è¡Œé™æ€åˆ†æã€‚
- **`scripts/clean_and_build.bat`**: (Windows) æ¸…ç†é¡¹ç›®å¹¶é‡æ–°æ„å»ºã€‚

å¦‚æœé¡¹ç›®åŒ…å«éœ€è¦ä»£ç ç”Ÿæˆçš„éƒ¨åˆ†ï¼ˆä¾‹å¦‚ `drift`ï¼‰ï¼Œè¯·è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```bash
flutter packages pub run build_runner build --delete-conflicting-outputs
```

## ğŸ¤ è´¡çŒ®æŒ‡å—

æˆ‘ä»¬æ¬¢è¿ä»»ä½•å½¢å¼çš„è´¡çŒ®ï¼æ— è®ºæ˜¯ Bug åé¦ˆã€åŠŸèƒ½å»ºè®®è¿˜æ˜¯ä»£ç æäº¤ã€‚

- **æŠ¥å‘Šé—®é¢˜**: å¦‚æœæ‚¨å‘ç°ä»»ä½• Bug æˆ–æœ‰å¥½çš„å»ºè®®ï¼Œè¯·é€šè¿‡ [Issues](https://github.com/alice-easy/Easy-Comic/issues) å‘Šè¯‰æˆ‘ä»¬ã€‚
- **æäº¤ä»£ç **:
  1. Fork æœ¬ä»“åº“ã€‚
  2. åˆ›å»ºæ‚¨çš„ç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)ã€‚
  3. æäº¤æ‚¨çš„æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)ã€‚
  4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)ã€‚
  5. æ‰“å¼€ä¸€ä¸ª Pull Requestã€‚

## ğŸ“¦ ä¸»è¦ä¾èµ–

æœ¬åº”ç”¨ä½¿ç”¨äº†ä»¥ä¸‹ä¼˜ç§€çš„å¼€æºåº“ï¼Œæ„Ÿè°¢è¿™äº›é¡¹ç›®çš„å¼€å‘è€…ä»¬ï¼

- [`flutter_riverpod`](https://pub.dev/packages/flutter_riverpod): çŠ¶æ€ç®¡ç†
- [`drift`](https://pub.dev/packages/drift): æœ¬åœ°æ•°æ®åº“
- [`webdav_client`](https://pub.dev/packages/webdav_client): WebDAV é€šä¿¡
- [`photo_view`](https://pub.dev/packages/photo_view): å›¾ç‰‡æŸ¥çœ‹ä¸æ‰‹åŠ¿æ”¯æŒ
- [`archive`](https://pub.dev/packages/archive): å‹ç¼©åŒ…å¤„ç†
- [`workmanager`](https://pub.dev/packages/workmanager): åå°ä»»åŠ¡
- ... ä»¥åŠå…¶ä»–ä¼˜ç§€çš„åº“ï¼

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ [MIT è®¸å¯è¯](LICENSE)ã€‚
